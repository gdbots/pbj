{% set classNameVMajor = getClassName(schema, true) %}
{% set insertionPoints = schema.language('php').get('insertion-points') %}
<?php

namespace {{ schema.language('php').get('namespace') }};

{% block use_statements %}
use Gdbots\Pbj\AbstractMessage;
use Gdbots\Pbj\FieldBuilder as Fb;
use Gdbots\Pbj\Schema;
use Gdbots\Pbj\Type as T;
{% set format_class = false %}
{% for field in schema.fields %}
{% if field.format %}
{% set format_class = true %}
{% endif %}
{% if field.language('php').get('classname') %}
use {{ field.language('php').get('classname') }};
{% endif %}
{% endfor %}
{% for mixin in schema.mixins %}
{% if not isSameNamespace(schema, mixin) %}
use {{ mixin.language('php').get('namespace') }}\{{ getClassName(mixin, true, classNameVMajor, true) }};
use {{ mixin.language('php').get('namespace') }}\{{ getClassName(mixin, true, classNameVMajor, true, 'Mixin') }};
use {{ mixin.language('php').get('namespace') }}\{{ getClassName(mixin, true, classNameVMajor, true, 'Trait') }};
{% endif %}
{% endfor %}
{% if format_class %}
use Gdbots\Pbj\Enum\Format;
{% endif %}
{% if insertionPoints %}
{{ indentString(insertionPoints.imports, 0) }}
{% endif %}
{% endblock use_statements %}

{% block class_definition %}
final class {{ classNameVMajor }} extends AbstractMessage implements
    {{ getClassName(schema) }}{% if schema.mixins|length %},{% endif %}

{% for mixin in schema.mixins %}
    {{ getClassName(mixin, true, classNameVMajor) }}{% if not loop.last %},{% endif %}

{% endfor %}
{% if schema.mixins|length %}
  {# note: linebreak for cleaner print #}

{% endif %}
{% endblock class_definition %}
{
{% block class_body %}
{% for mixin in schema.mixins %}
    use {{ getClassName(mixin, true, classNameVMajor, false, 'Trait') }};
{% endfor %}

    /**
     * @return Schema
     */
    protected static function defineSchema()
    {
{% if schema.fields|length or schema.mixins|length %}
        return new Schema('{{ schema.id }}', __CLASS__,
{% if schema.fields|length %}
            [
{% import 'php/macros.twig' as macros %}
{% for field in schema.fields %}
              {{ macros.draw_field(field, 16, loop.last) }}
{%- endfor %}
            ]{% if schema.mixins|length %},{% endif %}
{% else %}
            []{% if schema.mixins|length %},{% endif %}
{% endif %}

{% if schema.mixins|length %}
            [
{% for mixin in schema.mixins %}
                {{ getClassName(mixin, true, classNameVMajor, false, 'Mixin') }}::create(){% if not loop.last %}, {% endif %}

{% endfor %}
            ]
{% endif %}
        );
{% else %}
        return new Schema('{{ schema.id }}', __CLASS__);
{% endif %}
    }

{% if insertionPoints %}
{{ indentString(insertionPoints.methods, 4) }}
{% endif %}
{% endblock class_body %}
}
