<schema-mapping xmlns="gdbots:pbjc:schema-mapping"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <entity id="pbj:gdbots:pbj:mixin:command:2-0-0" mixin="true">
    <fields>
      <field name="command_id" type="time-uuid" required="true"/>
      <field name="microtime" type="microtime"/>
      <field name="correlator" type="message-ref" />
      <field name="retries" type="tiny-int" />
    </fields>

    <php_options>
      <namespace>Gdbots\Schemas\Pbj\Command</namespace>
      <trait_class>
        <use_statements>
            <![CDATA[
use Gdbots\Pbj\MessageRef;
            ]]>
        </use_statements>
        <class_body>
            <![CDATA[
    /**
     * @param string $tag
     * @return MessageRef
     */
    public function generateMessageRef($tag = null)
    {
        return new MessageRef(static::schema()->getCurie(), $this->get('command_id'), $tag);
    }

    /**
     * @return array
     */
    public function getUriTemplateVars()
    {
        return [
            'command_id' => (string)$this->get('command_id'),
            'microtime' => (string)$this->get('microtime'),
        ];
    }
            ]]>
        </class_body>
      </trait_class>
    </php_options>
  </entity>
</schema-mapping>
